dist: xenial
sudo: required
services:
- docker
jobs:
  include:
  - stage: Tests
    name: Unit Tests
    install:
    - docker build -t mmore500/conduit .
    - docker ps -a
    script:
    - docker run mmore500/conduit /bin/bash -c "cd /opt/conduit && make tests"
  - name: Macrobenchmarks
    install:
    - docker build -t mmore500/conduit .
    - docker ps -a
    script: docker run mmore500/conduit /bin/bash -c "cd /opt/conduit && make macrobenchmark"
  - name: Microbenchmarks
    install:
    - docker build -t mmore500/conduit .
    - docker ps -a
    script: docker run -e OSF_PASSWORD -e CONTEXT=travis mmore500/conduit /bin/bash -c "cd /opt/conduit && make microbenchmark"
  - name: Coverage
    install:
    - docker build -t mmore500/conduit .
    - docker ps -a
    script: docker run mmore500/conduit /bin/bash -c "cd /opt/conduit && make cov
      && bash <(curl -s https://codecov.io/bash)"
  - name: Source
    install:
    - docker build -t mmore500/conduit .
    - docker ps -a
    script: docker run --cap-add=SYS_ADMIN mmore500/conduit /bin/bash -c "cd /opt/conduit
      && source third-party/emsdk/emsdk_env.sh && make test-source"
  - stage: Deploy
    name: Deploy to GitHub Pages
    install:
    - docker build -t mmore500/conduit .
    - docker ps -a
    script:
    - docker run -e GH_TOKEN -e TRAVIS_BUILD_NUMBER -e TRAVIS_BRANCH mmore500/conduit
      /bin/bash -c "cd /opt/conduit && source third-party/emsdk/emsdk_env.sh && make
      web && ./ci/deploy_gh_pages.sh"
env:
  global:
  - secure: oZPMB8k0E1/nnJ1LqPBqGu8XKRWnvC3TzWa/CBryfJetmK8iNXng7lTFZpaCGBfpPM+Zyota7E0VGT9GE2MZznb9NrSPqSRgvwGqySSS31mFGcA5vPMQVfL1vA2mswpdTCZjGGZ86KCbb14IapxnsQ44TZNvmsA2jX5PrK4hrysJYVcS4KPNicQ0X2EwSq2hTugbtzCn2bd9H971joabO19YdVl6LaBhkhvFVRR/rbD+FSNx6EkfR1DKMpA7LGCrNw+sUKBjul4Xc8jb9Wjhc2nbRpbMIx/qJFwdoBjXzqGPY6FpdFyrkX/dnn3d3OrZcEuckRa02tyAepXEQm8jWeBUgwNu6arZm9GpA58O06Tk/i605XCSn4IhCe90ssPZu6xubp45Tmduthla8AJOM0rfSOcv0/3twsE5fPC1mGsB/kocZcOokLldZzh98AtO90KTaNNFjFfD5B7h1W4EOcIh2y8/Po8lnJISLT9DzuZCdIXRIs+MjXm+bkV8r7td6WNntjVoZzCuR5q/iWr6YTp/SjGYaMJNBvLEBgdxg4tCM3VUNcLAiIqO8LsxGEUZOur1uSOIbJ//idzUVk0+gr6tlPnwh7ZwP+vVGnfOuV1bMK7cslgs4Keo4BYUDdbKYH7rhIcMZHKf0aWmK4cGV/OIDp6SAXW0vtOAEcokg0Q=
  - secure: vnthCFzfA+jtExEdiEk1/aRmkanVBQsvrD6EwEcZ0djiBHx/c6QtUA3aIRazlJrTxSfcPKdH5LwPaJfXXhNoFlaWTwjMGHjcYZwYnNYqIqrx0qqqn1Q8UuGffKuAGdFv4jG8puSqLw/GWcZDCSplYCZ+dvjD8W4u+WcvckqE8pdDYXoMzr13lJXfu0Cr+kNz/SZxldgT6eq369HxUHrW9h4Di7p5Vi/Gr6QgWd9tGgMsgq0H5558hd8gIMJxfxRA67ZWxc2YqzbLl5xbI2Oz9rJFWkqe8/fYp0KJT1ghJXSsyVHs6LdXLead9tgqbocuZr9qtkwAJiyYR6p8p3d2tz5wqZ9/hpfTYlTSJ2Ro6Dp1yZSTNJN3DFxmVRPTx5WGtWwMUc69JcW3GFRm1QxECZMv93qpsLPGcnGAkT2kH6xIyI67d66m8MVe0htnpWEUF1oGq3qZLRXjKt2QT9aRa641wrfaJThqht4FTnl7TLawJDv/UhfnFM+a/AkL1+1uyPaAhFnci5nGCY5WlYWpxGYXeWk6SABRh09NuLmritRTPYC/wwKD42+B4EzC/fWGKSVfUHGUgjyNvJj5H6n2eV4a9YBj052U/1UJoMxpDu7sP/GqN4Ttrm9aJFumCSVFrkO/7x+U3necF1mKjnIc/v+uyk8TkCcRZrGvqvaogx8=
